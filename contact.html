<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vilana Event & Catering</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YW71FCW4FJ"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YW71FCW4FJ');
</script>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=Cormorant+SC:wght@400;500;700&display=swap" rel="stylesheet" />

<style>
body { font-family: 'Cormorant SC', serif; background-color: #fdfaf6; }
h1, h2, h3, p, span { font-family: 'Cormorant SC', serif; }
.logo-container { display: flex; align-items: baseline; gap: 0.3rem; margin-top: 4px; }
.logo-title { font-family: 'Cinzel Decorative', cursive; font-size: 1.8rem; font-weight: 500; letter-spacing: 0.5px; color: #1f2937; }
.logo-subtitle { font-size: 1.2rem; color: #1f2937; }
  .lang { display: none; }        /* скрываем, показываем нужный язык через JS */
  .hidden-field { display: none; }/* honeypot */
</style>
</head>
<body>

<!-- Плейсхолдеры: сюда подставятся шапка и футер из index.html -->
<div id="site-header"></div>

<main class="py-16">
<div class="mx-auto px-4 max-w-3xl text-center">
    <h2 class="text-4xl font-bold mb-12 lang lang-de" data-disp="block">Kontaktieren Sie uns</h2>
    <h2 class="text-4xl font-bold mb-12 lang lang-ru" data-disp="block">Свяжитесь с нами</h2>

    <div class="text-center mb-12 space-y-2">
    <p class="text-lg"><strong>E-Mail:</strong> <a href="mailto:v.s@vilana.info" class="text-amber-700">v.s@vilana.info</a></p>
    <p class="text-lg"><strong>Telefon 1:</strong> <a href="tel:+4917657775996" class="text-amber-700">+49 176 5777 5996</a></p>
    <p class="text-lg"><strong>Telefon 2:</strong> <a href="tel:+4917642288707" class="text-amber-700">+49 176 4228 8707</a></p>
    <p class="text-lg"><strong>WhatsApp:</strong> <a href="https://wa.me/4917657775996" class="text-amber-700" target="_blank" rel="noopener noreferrer">Jetzt schreiben</a></p>
    <p class="text-lg"><strong>Adresse:</strong> 31855 Aerzen / Osterstr. 28</p>
    </div>

    <form id="contactForm" class="bg-white p-8 rounded-lg shadow-md">
    <input type="text" name="honeypot" class="hidden-field" autocomplete="off">

    <div class="mb-4">
        <label for="name" class="block text-gray-700 mb-2">
        <span class="lang lang-de">Ihr Name</span>
        <span class="lang lang-ru">Ваше имя</span>
        </label>
        <input class="w-full border border-gray-300 rounded px-4 py-2" type="text" id="name" name="name" required />
    </div>

    <div class="mb-4">
        <label for="email" class="block text-gray-700 mb-2">
        <span class="lang lang-de">Ihre E-Mail</span>
        <span class="lang lang-ru">Ваш e-mail</span>
        </label>
        <input class="w-full border border-gray-300 rounded px-4 py-2" type="email" id="email" name="email" required />
    </div>

    <div class="mb-4">
        <label for="message" class="block text-gray-700 mb-2">
        <span class="lang lang-de">Ihre Nachricht</span>
        <span class="lang lang-ru">Ваше сообщение</span>
        </label>
        <textarea class="w-full border border-gray-300 rounded px-4 py-2" id="message" name="message" rows="5" required></textarea>
    </div>

    <div class="mb-4">
        <label class="inline-flex items-center">
        <input type="checkbox" required class="mr-2" />
        <span class="text-sm lang lang-de">Ich akzeptiere die <a href="vilana-legal.html" class="text-amber-700 underline">AGB & Datenschutz</a></span>
        <span class="text-sm lang lang-ru">Я принимаю <a href="vilana-legal.html" class="text-amber-700 underline">условия и политику конфиденциальности</a></span>
        </label>
    </div>

    <div id="formMsg" class="text-center text-green-600 font-semibold hidden mb-4">Nachricht erfolgreich gesendet!</div>

    <button type="submit" class="bg-amber-600 hover:bg-amber-700 text-white font-bold py-2 px-6 rounded-full">
        <span class="lang lang-de">Senden</span>
        <span class="lang lang-ru">Отправить</span>
    </button>
    </form>
</div>
</main>

<div id="site-footer"></div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<script>
/* ========= 1) Подтягиваем header/footer из index.html ========= */
async function loadFromIndex(selector, targetId) {
  try {
    const resp = await fetch('index.html', { cache: 'no-cache' });
    const text = await resp.text();
    const doc = new DOMParser().parseFromString(text, 'text/html');
    const part = doc.querySelector(selector);
    if (part) document.getElementById(targetId).innerHTML = part.outerHTML;
  } catch (err) {
    console.error('Ошибка загрузки из index.html:', err);
  }
}

/* ========= 2) Глобальная функция языка ========= */
window.setLanguage = window.setLanguage || function setLanguage(lang) {
  // сохраняем для всех страниц и для event-ссылки
  localStorage.setItem('vilana_lang', lang);

  // тумблеры на <html> (если стилизуешь по ним)
  document.documentElement.classList.toggle('lang-de', lang === 'de');
  document.documentElement.classList.toggle('lang-ru', lang === 'ru');

  // спрятать всё .lang и показать нужное
  document.querySelectorAll('.lang').forEach(el => el.style.display = 'none');

  const blockTags = new Set(['H1','H2','H3','H4','H5','H6','P','DIV','LI','UL','OL','SECTION','ARTICLE','FOOTER','HEADER']);
  document.querySelectorAll('.lang-' + lang).forEach(el => {
    const hint = el.getAttribute('data-disp');
    el.style.display = hint ? hint : (blockTags.has(el.tagName) ? 'block' : 'inline');
  });

  // подсветка активного флага (если кнопки есть в header)
  document.querySelectorAll('[onclick^="setLanguage"], [data-lang]').forEach(btn => {
    const isActive = (btn.getAttribute('onclick') || '').includes("'" + lang + "'") || btn.getAttribute('data-lang') === lang;
    btn.classList.toggle('ring-2', isActive);
    btn.classList.toggle('ring-amber-500', isActive);
  });
};

/* ========= 3) Ссылка Event с UTM и языком ========= */
(function(){
  const EVENT_ID = 'russian-oktoberfest-2025';
  function copyTrackingParams(fromURL, toURL) {
    const keep = ['utm_source','utm_medium','utm_campaign','utm_term','utm_content','gclid','fbclid'];
    for (const k of keep) {
      const v = fromURL.searchParams.get(k);
      if (v) toURL.searchParams.set(k, v);
    }
  }
  window.setEventLinks = function setEventLinks() {
    const url  = new URL(location.href);
    const lang = (url.searchParams.get('lang') || localStorage.getItem('vilana_lang') || 'de').toLowerCase();

    const ev = new URL('event.html', url);
    ev.searchParams.set('id', EVENT_ID);
    ev.searchParams.set('lang', lang);
    copyTrackingParams(url, ev);

    const selectors = '#eventLink, #eventLinkMobile, #eventLinkFooter, a[data-ev-link]';
    document.querySelectorAll(selectors).forEach(a => { a.href = ev.href; });
  };
})();

/* ========= 4) Инициализация меню ========= */
function initHeaderInteractions() {
  const toggleBtn  = document.getElementById('menuToggle');
  const mobileMenu = document.getElementById('mobileMenu');
  if (toggleBtn && mobileMenu) {
    toggleBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
  }
}

/* ========= 5) Делегирование кликов по кнопкам языка (без inline) ========= */
document.addEventListener('click', (e) => {
  const btn = e.target.closest('[data-lang]');
  if (!btn) return;
  const lang = btn.getAttribute('data-lang');
  window.setLanguage(lang);
});

/* ========= 6) EmailJS ========= */
function initEmailJS() {
  emailjs.init("vfmomNKrMxrf2xqDW"); // ваш public key
const form = document.getElementById("contactForm");
if (!form) return;
form.addEventListener("submit", function (e) {
    e.preventDefault();
    if (form.honeypot.value !== "") return; // антиспам
    emailjs.sendForm('service_75biswm', 'template_fuxgrlb', form)
    .then(() => {
        document.getElementById("formMsg").classList.remove("hidden");
        form.reset();
    }, (error) => {
        alert("Fehler beim Senden: " + (error?.text || 'Unbekannter Fehler'));
    });
});
}

/* ========= 7) Boot ========= */
document.addEventListener('DOMContentLoaded', async () => {
  // подставляем header/footer из index.html
await loadFromIndex('header', 'site-header');
await loadFromIndex('footer', 'site-footer');

  // теперь элементы header уже в DOM — можно навесить логику меню
initHeaderInteractions();
// === ДОБАВИТЬ ОТСУТСТВУЮЩИЕ КНОПКИ ЯЗЫКА ===
function ensureLangButtons() {
  // Desktop блок с флагами
const desktopLangBox =
    document.querySelector('.md\\:flex.gap-2')  // твой контейнер с кнопками
    || (function(){ // если контейнера нет — создадим справа от навигации
        const navWrap = document.querySelector('header .container > div.flex.justify-between');
        const box = document.createElement('div');
        box.className = 'hidden md:flex gap-2';
        navWrap?.appendChild(box);
        return box;
    })();

if (desktopLangBox) {
    // DE
    if (!desktopLangBox.querySelector('[data-lang="de"],[onclick*="setLanguage(\'de\')"]')) {
    const deBtn = document.createElement('button');
    deBtn.type = 'button';
    deBtn.setAttribute('data-lang','de');
    deBtn.className = 'px-2';
    deBtn.textContent = '🇩🇪';
    desktopLangBox.appendChild(deBtn);
    }
    // RU
    if (!desktopLangBox.querySelector('[data-lang="ru"],[onclick*="setLanguage(\'ru\')"]')) {
    const ruBtn = document.createElement('button');
    ruBtn.type = 'button';
    ruBtn.setAttribute('data-lang','ru');
    ruBtn.className = 'px-2';
    ruBtn.textContent = '🇷🇺';
    desktopLangBox.appendChild(ruBtn);
    }
}

  // Mobile меню: добавим строку с языками, если её нет
const mobileMenu = document.getElementById('mobileMenu');
if (mobileMenu && !mobileMenu.querySelector('.lang-row')) {
    const row = document.createElement('div');
    row.className = 'lang-row flex gap-3 items-center pt-2';
    row.innerHTML = `
    <button type="button" data-lang="de" class="px-2">🇩🇪</button>
    <button type="button" data-lang="ru" class="px-2">🇷🇺</button>
    `;
    mobileMenu.prepend(row);
}
}

// === ВСТАВЬ В СВОЙ BOOT ПОСЛЕ loadFromIndex ===
document.addEventListener('DOMContentLoaded', async () => {
await loadFromIndex('header', 'site-header');
await loadFromIndex('footer', 'site-footer');

  // добавим недостающие кнопки языка
ensureLangButtons();

  // дальше — твои существующие вызовы:
initHeaderInteractions?.();

const url = new URL(location.href);
const urlLang = (url.searchParams.get('lang') || '').toLowerCase();
const saved   = (localStorage.getItem('vilana_lang') || '').toLowerCase();
window.setLanguage(urlLang || saved || 'de');

window.setEventLinks?.();
initEmailJS?.();
});

  // язык: ?lang=… > localStorage > de
const url = new URL(location.href);
const urlLang = (url.searchParams.get('lang') || '').toLowerCase();
const saved   = (localStorage.getItem('vilana_lang') || '').toLowerCase();
window.setLanguage(urlLang || saved || 'de');

  // обновляем ссылки Event (использует сохранённый язык)
window.setEventLinks();

  // EmailJS
initEmailJS();
});
</script>

</body>
</html>
